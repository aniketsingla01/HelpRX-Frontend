<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Medicine Finder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="script/angular.min.js"></script>
    <script>
        var module = angular.module("Mymodule", []);
        module.controller("Mycontroller", function ($scope, $http) {
            $scope.cityJSONAry = "";
            $scope.jsoncity;
            $scope.fetchCities = function () {
                var url = "/fetch-city-donors";
                $http.get(url).then(done, fail);
                function done(resp) {
                    // alert(JSON.stringify(resp.data));
                    $scope.jsoncity = resp.data;
                }
                function fail(resp) {
                    alert(resp.data);
                }
            }
            $scope.selcity = function () {
                //  alert($scope.cityJSONAry.email);
            }
            //===============================
            $scope.jsonmed;
            $scope.medJSONAry = "";
            $scope.selmed = function () {
                //alert($scope.medJSONAry.med);
            }
            $scope.fetchMed = function () {
                //alert();
                var url = "/fetch-meds-donors";
                $http.get(url).then(done, fail);
                function done(resp) {
                    //   alert(JSON.stringify(resp.data));
                    $scope.jsonmed = resp.data;
                }
                function fail(resp) {
                    alert(resp.data);
                }
            }

            $scope.JsonArr3;
            $scope.fetchDonors = function () {
                //alert();
                var url = "/fetch-donors?mednameKuch=" + $scope.medJSONAry.medname + "&cityKuch=" + $scope.cityJSONAry.city;
                alert(url);
                $http.get(url).then(done, fail);
                function done(response) {
                    alert(JSON.stringify(response.data));
                    $scope.JsonArr3 = response.data;
                }
                function fail(response) {
                    alert(response.data);
                }
            }

            $scope.selOneObj;
            $scope.doShowOne = function (selIndex) {
                $scope.selOneObj = $scope.JsonArr3[selIndex];
            }
        });
    </script>
</head>

<body style="background-color: blanchedalmond;" ng-app="Mymodule" ng-controller="Mycontroller"
    ng-init="fetchCities();fetchMed();">

    <nav class="navbar bg-body-tertiary mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">HelpRX</span>
        </div>
    </nav>

    <div class="container">
        <h1 class="offset-md-5 mb-4">Medicine Finder</h1>
        <div class="row">
            <div class="col-md-3 mt-3 offset-md-3">
                <label class="form-label"style="font-size: larger;"><b>City</b></label>
                <select class="form-select" ng-options="obj.city for obj in jsoncity" ng-model="cityJSONAry"
                    ng-change="selcity();">
                    <option selected>Select</option>
                </select>
            </div>
            <div class="col-md-3 mt-3 ms-4">
                <label class="form-label" style="font-size: larger;"><b>Medicines List</b></label>
                <select class="form-select" ng-options="obj.medname
                 for obj in jsonmed" ng-model="medJSONAry" ng-change="selmed();">
                    <option selected>Select</option>

                </select>
            </div>
        </div>

        <div class="col-md-4 offset-md-4 mt-5">
            <center>
                <input type="button" class="btn btn-outline-success" value="Get DONORS" ng-click="fetchDonors();"
                    style="width: 300px">
            </center>
        </div>

        <div class="row">
            <div class="col-md-3 mt-3" ng-repeat="obj in JsonArr3">
                <div class="card">
                    <center>
                        <img src="pics/1.jpeg" style="width: 10vw; margin-top: 3;" class="card-img-top"
                            alt="Pic Missing">
                    </center>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">
                                        <h5 class="card-title">Name={{obj.name}}</h5>
                                    </th>
                                </tr>
                                <tr>
                                    <th scope="col">
                                        <h5 class="card-title">Address={{obj.address}}</h5>
                                    </th>
                                </tr>
                                <tr>
                                    <th scope="col">
                                        <h5 class="card-title">Availability Hours={{obj.availhours}}</h5>
                                    </th>
                                </tr>
                            </thead>
                        </table>
                        <!-- <h5 class="card-title">Name={{obj.name}}</h5>
                        <h5 class="card-title">Address={{obj.address}}</h5>
                        <h5 class="card-title">Contact={{obj.contact}}</h5>
                        <h5 class="card-title">Avalability Hours={{obj.availhours}}</h5>
                        -->
                        <center>
                            <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalDetails"
                                ng-click="doShowOne($index);">Details</a>
                        </center>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" tabindex="-1" id="modalDetails">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">EmailID={{selOneObj.emailid}}</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <center>
                        <img src="pics/1.jpeg" width="100" height="100" alt="">
                    </center>

                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">
                                    <h5 class="card-title">Name={{selOneObj.name}}</h5>
                                </th>
                            </tr>
                            <tr>
                                <th scope="col">
                                    <h5 class="card-title">Contact={{selOneObj.contact}}</h5>
                                </th>
                            </tr>
                            <tr>
                                <th scope="col">
                                    <h5 class="card-title">Address={{selOneObj.address}}</h5>
                                </th>
                            </tr>
                            <tr>
                                <th scope="col">
                                    <h5 class="card-title">City={{selOneObj.city}}</h5>
                                </th>
                            </tr>
                            <tr>
                                <th scope="col">
                                    <h5 class="card-title">Availability Hours={{selOneObj.availhours}}</h5>
                                </th>
                            </tr>
                        </thead>
                    </table>
<!--                     
                    <h5>Name={{selOneObj.name}}</h5>
                    <h5>Contact={{selOneObj.contact}}</h5>
                    <h5>Address={{selOneObj.address}}</h5>
                    <h5>City={{selOneObj.city}}</h5>
                    <h5>Availability Hours={{selOneObj.availhours}}</h5> -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>